<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">

<script charset="utf-8" type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

<title>Example linking two plots with D3</title>
</head>

<body>
<h2>Example linking two plots with D3</h2>

<div>
    <canvas id="accuracyChart" width="400" height="300"></canvas>
</div>

<svg id="timeSeriesChart"></svg> <!-- Add an SVG element with an ID -->

<script >
    // Accuracy Chart
    function createAccuracyChart(id, data) {
        var accuracyData = data;

        var time = accuracyData['RL'].length;

        if (time < 1) {
            alert('Not Enough Data to Derive Hit Rate View. Rendering Other Views');
            return;
        }

        var timeLabels = Array.from({ length: time }, (_, i) => i.toString());

        var datasets = Object.keys(accuracyData).map(key => {
            return {
                label: key,
                data: accuracyData[key],
                fill: false,
                borderColor: key === "RL" ? "blue" : key === "Random" ? "green" : "red"
            };
        });

        var accuracyChart = new Chart(id, {
            type: "line",
            data: {
                labels: timeLabels,
                datasets: datasets
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: "Hit Rate Over Time"
                },
                scales: {
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: "Time"
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: "Hit Rate"
                        }
                    }]
                }
            }
        });
    }

    // Shift Focus Chart
    const RlHistory = [
        ['aircraft_airline_operator', 'cost_repair'],
        ['wildlife_species', 'wildlife_size'], // Adjusted attribute names here
        ['wildlife_species', 'cost_repair'],
        ['wildlife_species', 'cost_repair']// Adjusted attribute names here
    ];
    const attributeHistory = [
        ['aircraft_airline_operator', 'cost_repair'],
        ['wildlife_species', 'wildlife_size'], // Adjusted attribute names here
        ['wildlife_species', 'cost_repair'],
        ['wildlife_species', 'cost_repair']// Adjusted attribute names here
    ];

    const fieldNames = ['airport_name', 'aircraft_make_model', 'effect_amount_of_damage', 'flight_date', 'aircraft_airline_operator', 'origin_state', 'when_phase_of_flight', 'wildlife_size', 'wildlife_species', 'when_time_of_day', 'cost_other', 'cost_repair', 'cost_total_a', 'speed_ias_in_knots'];

    const timeSeriesData = attributeHistory.map((attributes, index) => {
        const dataPoint = { time: index };
        fieldNames.forEach((field, fieldIndex) => {
            dataPoint[field] = attributes.includes(field) ? fieldIndex : null;
        });
        return dataPoint;
    });

    console.log(timeSeriesData)

    const margin = { top: 20, right: 50, bottom: 50, left: 190 }; // Adjusted left margin
    const width = Math.max(window.innerWidth * 0.8 - margin.left - margin.right, 300); // Minimum width
    const height = window.innerHeight * 0.6 - margin.top - margin.bottom;

    const svg = d3.select("#timeSeriesChart")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

    const x = d3.scaleBand() // Changed to scaleBand
        .domain(timeSeriesData.map(d => d.time))
        .range([0, width])
        .padding(0.1); // Adjusted padding between bars

    const y = d3.scaleBand()
        .domain(fieldNames)
        .range([height, 0])
        .padding(0.1); // Adjusted padding between bars

    const colors = d3.scaleOrdinal(d3.schemeCategory10);

    svg.selectAll(".line")
        .data(timeSeriesData)
        .enter().append("g")
        .each(function (d) {
            const group = d3.select(this);
            fieldNames.forEach(field => {
                if (d[field] !== null) {
                    group.append("rect")
                        .attr("x", x(d.time))
                        .attr("y", y(field))
                        .attr("width", x.bandwidth()) // Adjusted width of bars
                        .attr("height", y.bandwidth())
                        .attr("fill", colors(field))
                        .attr("class", "bar")
                        .attr("data-index", d[field]); // Set data-index attribute
                }
            });
        })
        .on("mouseover", function() {
            d3.select(this).attr("fill", "grey"); // Change color on hover
        })
        .on("mouseout", function() {
            const fieldIndex = this.getAttribute("data-index"); // Access data-index attribute
            const field = fieldNames[fieldIndex];
            d3.select(this).attr("fill", colors(field)); // Restore original color
        });

    svg.append("g")
        .attr("transform", `translate(0,${height})`)
        .call(d3.axisBottom(x).ticks(timeSeriesData.length - 1).tickFormat(d3.format("d"))); // Adjusted tick format

    svg.append("g")
        .call(d3.axisLeft(y))
        .selectAll("text")
        .style("font-size", "14px") // Increase font size
        .style("font-weight", "bold"); // Make text bold

    svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin.left)
        .attr("x", 0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Attribute");

    svg.append("text")
        .attr("transform", `translate(${width / 2},${height + margin.top + 10})`)
        .style("text-anchor", "middle")
        .text("Interactions Observed");

    const legendContainer = svg.append("g")
        .attr("class", "legend-container") // Added a class for styling and scrolling
        .attr("transform", `translate(${margin.left},${height + 50})`);

    const legend = legendContainer.selectAll("g")
        .data(fieldNames)
        .enter().append("g")
        .attr("transform", (d, i) => `translate(0,${i * 20})`);

    legend.append("rect")
        .attr("x", 0)
        .attr("width", 10)
        .attr("height", 10)
        .attr("fill", colors);

    legend.append("text")
        .attr("x", 15)
        .attr("y", 5)
        .attr("dy", "0.75em")
        .text(d => d);

    // Highlight matching elements based on RLHistory
    RlHistory.forEach((interaction, index) => {
        const time = index;
        interaction.forEach(attribute => {
            const fieldIndex = fieldNames.indexOf(attribute);
            if (fieldIndex !== -1) {
                svg.select(`[data-index="${fieldIndex}"][x="${x(time)}"]`)
                    .attr("fill", "orange");
            }
        });
    });

    // Sample accuracy data
    const accuracyData = {
        'RL': [0.5, 0.4, 0.9],
        'Momentum': [0.2, 0.2, 0.9],
        'Random': [0.2, 0.9, 0.05]
    };

    // Call the function to create accuracy chart
    createAccuracyChart('accuracyChart', accuracyData);
</script>
</body>
</html>
